---
title: "æ•™ç¨‹0: macOSç¯å¢ƒå®Œæ•´å®‰è£…æŒ‡å—"
author: "ICellbioRpyæ•™ç¨‹"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    theme: cosmo
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, eval = FALSE)
```

# ğŸ¯ æ•™ç¨‹ç›®æ ‡

è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸º**å®Œå…¨é›¶åŸºç¡€çš„åˆå­¦è€…**å‡†å¤‡çš„macOSç³»ç»Ÿç¯å¢ƒå®‰è£…æ•™ç¨‹ã€‚æˆ‘ä»¬å°†ä»æœ€åŸºç¡€çš„è½¯ä»¶ä¸‹è½½å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥åœ°æ­å»ºå®Œæ•´çš„ICellbioRpyä½¿ç”¨ç¯å¢ƒã€‚

**å®Œæˆæœ¬æ•™ç¨‹åï¼Œæ‚¨å°†æ‹¥æœ‰ï¼š**
- âœ… Rå’ŒRStudioå·¥ä½œç¯å¢ƒ
- âœ… Anaconda Pythonç¯å¢ƒ
- âœ… ä¸“ç”¨çš„condaç¯å¢ƒ
- âœ… ICellbioRpyåŒ…åŠå…¶ä¾èµ–
- âœ… å®Œå…¨é…ç½®å¥½çš„Python-Räº¤äº’ç¯å¢ƒ

**é¢„è®¡æ—¶é—´ï¼š** 1-2å°æ—¶ï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰

# ğŸ“‹ å¼€å§‹å‰çš„å‡†å¤‡

## æ£€æŸ¥æ‚¨çš„ç³»ç»Ÿ

1. **ç¡®è®¤æ‚¨ä½¿ç”¨çš„æ˜¯macOSç³»ç»Ÿ**ï¼ˆæœ¬æ•™ç¨‹é€‚ç”¨äºmacOS 10.15+ï¼‰
2. **æ£€æŸ¥æ‚¨çš„MacèŠ¯ç‰‡ç±»å‹**ï¼š
   - ç‚¹å‡»å±å¹•å·¦ä¸Šè§’çš„ğŸå›¾æ ‡
   - é€‰æ‹©"å…³äºæœ¬æœº"
   - æŸ¥çœ‹"èŠ¯ç‰‡"æˆ–"å¤„ç†å™¨"ä¿¡æ¯ï¼š
     - **Apple Silicon (M1/M2/M3)**ï¼šæ˜¾ç¤º"Apple M1"ã€"Apple M2"ç­‰
     - **Intel**ï¼šæ˜¾ç¤º"Intel Core i5"ã€"Intel Core i7"ç­‰
3. **ç¡®ä¿æ‚¨æœ‰ç®¡ç†å‘˜æƒé™**ï¼ˆå®‰è£…è½¯ä»¶æ—¶å¯èƒ½éœ€è¦ï¼‰
4. **ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š**ï¼ˆéœ€è¦ä¸‹è½½è¾ƒå¤§çš„å®‰è£…æ–‡ä»¶ï¼‰
5. **å‡†å¤‡è‡³å°‘5GBçš„ç£ç›˜ç©ºé—´**

## æœ¬æ•™ç¨‹çš„ç‰¹ç‚¹

- ğŸ” **è¶…è¯¦ç»†æ­¥éª¤**ï¼šæ¯ä¸€æ­¥éƒ½æœ‰è¯´æ˜
- ğŸ **Apple Siliconä¼˜åŒ–**ï¼šé’ˆå¯¹Mç³»åˆ—èŠ¯ç‰‡çš„ç‰¹æ®Šè¯´æ˜
- ğŸš¨ **é”™è¯¯é¢„é˜²**ï¼šæå‰è¯´æ˜å¯èƒ½é‡åˆ°çš„é—®é¢˜
- ğŸ’¡ **å°è´´å£«**ï¼šå®ç”¨çš„æ“ä½œå»ºè®®
- ğŸ”§ **æ•…éšœæ’é™¤**ï¼šå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•

# ç¬¬ä¸€æ­¥ï¼šå®‰è£…Xcode Command Line Tools

åœ¨macOSä¸Šï¼Œå¾ˆå¤šè½¯ä»¶ç¼–è¯‘éœ€è¦Xcode Command Line Toolsã€‚

## 1.1 å®‰è£…Command Line Tools

1. **æ‰“å¼€ç»ˆç«¯ï¼ˆTerminalï¼‰**ï¼š
   - æŒ‰ `Cmd + ç©ºæ ¼é”®` æ‰“å¼€Spotlightæœç´¢
   - è¾“å…¥"Terminal"æˆ–"ç»ˆç«¯"
   - æŒ‰å›è½¦é”®æ‰“å¼€

2. **å®‰è£…Command Line Tools**ï¼š
   ```bash
   xcode-select --install
   ```

3. **åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­**ï¼š
   - ç‚¹å‡» **"Install"ï¼ˆå®‰è£…ï¼‰**
   - åŒæ„è®¸å¯åè®®
   - ç­‰å¾…ä¸‹è½½å’Œå®‰è£…å®Œæˆï¼ˆå¯èƒ½éœ€è¦10-30åˆ†é’Ÿï¼‰

4. **éªŒè¯å®‰è£…**ï¼š
   ```bash
   xcode-select -p
   ```
   åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š`/Applications/Xcode.app/Contents/Developer` æˆ– `/Library/Developer/CommandLineTools`

âœ… **çœ‹åˆ°è·¯å¾„ä¿¡æ¯è¯´æ˜Command Line Toolså®‰è£…æˆåŠŸï¼**

# ç¬¬äºŒæ­¥ï¼šå®‰è£…Rè¯­è¨€

## 2.1 ä¸‹è½½R

1. **æ‰“å¼€Safariæˆ–Chromeæµè§ˆå™¨**

2. **è®¿é—®Rå®˜æ–¹ç½‘ç«™**ï¼š
   - åœ¨åœ°å€æ è¾“å…¥ï¼š`https://www.r-project.org/`
   - æŒ‰å›è½¦é”®

3. **è¿›å…¥ä¸‹è½½é¡µé¢**ï¼š
   - ç‚¹å‡»é¡µé¢ä¸Šçš„ **"CRAN"** é“¾æ¥
   - é€‰æ‹©ä¸€ä¸ªé•œåƒç«™ç‚¹ï¼ˆå»ºè®®é€‰æ‹©æ—¥æœ¬æˆ–é¦™æ¸¯çš„é•œåƒï¼Œé€Ÿåº¦è¾ƒå¿«ï¼‰

4. **é€‰æ‹©macOSç‰ˆæœ¬**ï¼š
   - ç‚¹å‡» **"Download R for macOS"**
   - **é‡è¦**ï¼šæ ¹æ®æ‚¨çš„MacèŠ¯ç‰‡é€‰æ‹©åˆé€‚ç‰ˆæœ¬ï¼š
     - **Apple Silicon (M1/M2/M3)**ï¼šé€‰æ‹© **"R-4.x.x-arm64.pkg"**
     - **Intel Mac**ï¼šé€‰æ‹© **"R-4.x.x.pkg"**

ğŸ’¡ **å°è´´å£«**ï¼šå¦‚æœä¸ç¡®å®šèŠ¯ç‰‡ç±»å‹ï¼Œé€‰æ‹©Intelç‰ˆæœ¬ä¹Ÿå¯ä»¥åœ¨Apple Siliconä¸Šè¿è¡Œï¼ˆé€šè¿‡Rosettaï¼‰ã€‚

## 2.2 å®‰è£…R

1. **æ‰¾åˆ°ä¸‹è½½çš„æ–‡ä»¶**ï¼š
   - é€šå¸¸åœ¨"ä¸‹è½½"æ–‡ä»¶å¤¹ä¸­
   - æ–‡ä»¶åç±»ä¼¼ï¼š`R-4.4.3-arm64.pkg` æˆ– `R-4.4.3.pkg`

2. **åŒå‡»å®‰è£…æ–‡ä»¶**

3. **æŒ‰ç…§å®‰è£…å‘å¯¼æ“ä½œ**ï¼š
   - ç‚¹å‡» **"ç»§ç»­"**
   - é˜…è¯»è®¸å¯åè®®ï¼Œç‚¹å‡» **"åŒæ„"**
   - é€‰æ‹©å®‰è£…ä½ç½®ï¼š**ä¿æŒé»˜è®¤**ï¼ˆé€šå¸¸æ˜¯Macintosh HDï¼‰
   - ç‚¹å‡» **"å®‰è£…"**
   - è¾“å…¥æ‚¨çš„å¯†ç ï¼ˆç®¡ç†å‘˜å¯†ç ï¼‰
   - ç­‰å¾…å®‰è£…å®Œæˆ

4. **å®Œæˆå®‰è£…**ï¼š
   - çœ‹åˆ°"å®‰è£…æˆåŠŸ"æç¤º
   - ç‚¹å‡» **"å…³é—­"**

## 2.3 éªŒè¯Rå®‰è£…

1. **æ‰“å¼€ç»ˆç«¯**

2. **è¾“å…¥ä»¥ä¸‹å‘½ä»¤**ï¼š
   ```bash
   R --version
   ```

3. **å¦‚æœçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼Œè¯´æ˜å®‰è£…æˆåŠŸ**ï¼š
   ```
   R version 4.4.3 (2025-02-28) -- "Trophy Case"
   Copyright (C) 2025 The R Foundation for Statistical Computing
   Platform: aarch64-apple-darwin20 (64-bit)
   ```

âœ… **çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯è¯´æ˜Rå®‰è£…æˆåŠŸï¼**

# ç¬¬ä¸‰æ­¥ï¼šå®‰è£…RStudio

## 3.1 ä¸‹è½½RStudio

1. **è®¿é—®RStudioå®˜ç½‘**ï¼š
   - åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š`https://rstudio.com/products/rstudio/download/`

2. **é€‰æ‹©å…è´¹ç‰ˆæœ¬**ï¼š
   - æ‰¾åˆ° **"RStudio Desktop"**
   - ç‚¹å‡» **"Download"** æŒ‰é’®

3. **ä¸‹è½½macOSç‰ˆæœ¬**ï¼š
   - ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ‚¨çš„æ“ä½œç³»ç»Ÿ
   - ç‚¹å‡» **"Download RStudio Desktop for macOS"**
   - ä¸‹è½½æ–‡ä»¶åç±»ä¼¼ï¼š`RStudio-2024.xx.x-xxx.dmg`

## 3.2 å®‰è£…RStudio

1. **æ‰“å¼€ä¸‹è½½çš„DMGæ–‡ä»¶**ï¼š
   - åŒå‡»ä¸‹è½½çš„`.dmg`æ–‡ä»¶
   - ç³»ç»Ÿä¼šæŒ‚è½½ç£ç›˜é•œåƒ

2. **æ‹–åŠ¨å®‰è£…**ï¼š
   - åœ¨æ‰“å¼€çš„çª—å£ä¸­ï¼Œå°†RStudioå›¾æ ‡æ‹–åŠ¨åˆ°Applicationsæ–‡ä»¶å¤¹
   - ç­‰å¾…å¤åˆ¶å®Œæˆ

3. **å¯åŠ¨RStudio**ï¼š
   - æ‰“å¼€Finderï¼Œè¿›å…¥"åº”ç”¨ç¨‹åº"æ–‡ä»¶å¤¹
   - æ‰¾åˆ°RStudioï¼ŒåŒå‡»å¯åŠ¨
   - å¦‚æœå‡ºç°å®‰å…¨æç¤ºï¼Œç‚¹å‡» **"æ‰“å¼€"**

## 3.3 é¦–æ¬¡å¯åŠ¨RStudio

1. **RStudioç•Œé¢è¯´æ˜**ï¼š
   - **å·¦ä¸‹è§’**ï¼šConsoleï¼ˆæ§åˆ¶å°ï¼‰- åœ¨è¿™é‡Œè¿è¡ŒRä»£ç 
   - **å·¦ä¸Šè§’**ï¼šSourceï¼ˆæºä»£ç ç¼–è¾‘å™¨ï¼‰
   - **å³ä¸Šè§’**ï¼šEnvironmentï¼ˆç¯å¢ƒå˜é‡ï¼‰
   - **å³ä¸‹è§’**ï¼šFiles/Plots/Packagesï¼ˆæ–‡ä»¶/å›¾å½¢/åŒ…ç®¡ç†ï¼‰

2. **æµ‹è¯•RStudio**ï¼š
   - åœ¨Consoleä¸­è¾“å…¥ï¼š`1 + 1`
   - æŒ‰å›è½¦ï¼Œåº”è¯¥çœ‹åˆ°ç»“æœï¼š`[1] 2`

âœ… **å¦‚æœçœ‹åˆ°æ­£ç¡®ç»“æœï¼Œè¯´æ˜Rå’ŒRStudioéƒ½å®‰è£…æˆåŠŸäº†ï¼**

# ç¬¬å››æ­¥ï¼šå®‰è£…Anaconda

## 4.1 ä¸ºä»€ä¹ˆéœ€è¦Anacondaï¼Ÿ

Anacondaæ˜¯ä¸€ä¸ªPythonå‘è¡Œç‰ˆï¼Œå®ƒï¼š
- åŒ…å«Pythonè§£é‡Šå™¨
- åŒ…å«ç§‘å­¦è®¡ç®—å¸¸ç”¨çš„åº“
- æä¾›condaåŒ…ç®¡ç†å™¨
- å¯ä»¥åˆ›å»ºç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒ
- åœ¨macOSä¸Šå…¼å®¹æ€§æ›´å¥½

## 4.2 ä¸‹è½½Anaconda

1. **è®¿é—®Anacondaå®˜ç½‘**ï¼š
   - åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š`https://www.anaconda.com/products/distribution`

2. **é€‰æ‹©macOSç‰ˆæœ¬**ï¼š
   - ç‚¹å‡» **"Download"** æŒ‰é’®
   - **é‡è¦**ï¼šæ ¹æ®æ‚¨çš„MacèŠ¯ç‰‡é€‰æ‹©ï¼š
     - **Apple Silicon (M1/M2/M3)**ï¼šé€‰æ‹© **"64-Bit (M1) Graphical Installer"**
     - **Intel Mac**ï¼šé€‰æ‹© **"64-Bit Graphical Installer"**

ğŸ’¡ **å°è´´å£«**ï¼šAnacondaå®‰è£…æ–‡ä»¶å¾ˆå¤§ï¼ˆçº¦500MBï¼‰ï¼Œè¯·ç¡®ä¿ç½‘ç»œç¨³å®šã€‚

## 4.3 å®‰è£…Anaconda

1. **è¿è¡Œå®‰è£…æ–‡ä»¶**ï¼š
   - æ‰¾åˆ°ä¸‹è½½çš„æ–‡ä»¶ï¼ˆç±»ä¼¼`Anaconda3-2024.xx-MacOSX-arm64.pkg`ï¼‰
   - åŒå‡»è¿è¡Œ

2. **å®‰è£…æ­¥éª¤**ï¼š
   - ç‚¹å‡» **"ç»§ç»­"**
   - ç‚¹å‡» **"åŒæ„"** æ¥å—è®¸å¯åè®®
   - é€‰æ‹©å®‰è£…ä½ç½®ï¼š**ä¿æŒé»˜è®¤**ï¼ˆæ¨èï¼‰
   - ç‚¹å‡» **"å®‰è£…"**
   - è¾“å…¥ç®¡ç†å‘˜å¯†ç 
   - ç­‰å¾…å®‰è£…å®Œæˆï¼ˆå¯èƒ½éœ€è¦10-20åˆ†é’Ÿï¼‰

3. **å®Œæˆå®‰è£…**ï¼š
   - çœ‹åˆ°å®‰è£…æˆåŠŸæç¤º
   - ç‚¹å‡» **"å…³é—­"**

## 4.4 é…ç½®Shellç¯å¢ƒ

Anacondaå®‰è£…åéœ€è¦é…ç½®Shellç¯å¢ƒï¼š

1. **æ‰“å¼€ç»ˆç«¯**

2. **åˆå§‹åŒ–conda**ï¼š
   ```bash
   /opt/anaconda3/bin/conda init zsh
   ```
   
   å¦‚æœæ‚¨ä½¿ç”¨bash shellï¼Œè¿è¡Œï¼š
   ```bash
   /opt/anaconda3/bin/conda init bash
   ```

3. **é‡æ–°å¯åŠ¨ç»ˆç«¯**ï¼š
   - å…³é—­å½“å‰ç»ˆç«¯çª—å£
   - é‡æ–°æ‰“å¼€ç»ˆç«¯

4. **éªŒè¯condaå®‰è£…**ï¼š
   ```bash
   conda --version
   ```
   åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š`conda 24.x.x`

5. **éªŒè¯Python**ï¼š
   ```bash
   python --version
   ```
   åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š`Python 3.11.x`

âœ… **å¦‚æœçœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜Anacondaå®‰è£…æˆåŠŸï¼**

# ç¬¬äº”æ­¥ï¼šåˆ›å»ºä¸“ç”¨condaç¯å¢ƒ

## 5.1 ä¸ºä»€ä¹ˆéœ€è¦ä¸“ç”¨ç¯å¢ƒï¼Ÿ

åˆ›å»ºä¸“ç”¨ç¯å¢ƒçš„å¥½å¤„ï¼š
- é¿å…åŒ…å†²çª
- æ›´å¥½çš„ç‰ˆæœ¬ç®¡ç†
- å‡ºé—®é¢˜æ—¶å¯ä»¥é‡æ–°åˆ›å»º
- ä¸å½±å“ç³»ç»Ÿé»˜è®¤Python

## 5.2 åˆ›å»ºICellbioRpyä¸“ç”¨ç¯å¢ƒ

1. **ç¡®ä¿ç»ˆç«¯å·²ç»é…ç½®å¥½conda**ï¼ˆåº”è¯¥çœ‹åˆ°å‘½ä»¤æç¤ºç¬¦å‰æœ‰`(base)`ï¼‰

2. **åˆ›å»ºæ–°ç¯å¢ƒ**ï¼š
   ```bash
   conda create -n 1cellbio python=3.11
   ```
   - `-n 1cellbio`ï¼šç¯å¢ƒåç§°ä¸º"1cellbio"
   - `python=3.11`ï¼šæŒ‡å®šPythonç‰ˆæœ¬

3. **ç¡®è®¤åˆ›å»º**ï¼š
   - å½“æç¤º "Proceed ([y]/n)?" æ—¶ï¼Œè¾“å…¥ `y` å¹¶æŒ‰å›è½¦
   - ç­‰å¾…ç¯å¢ƒåˆ›å»ºå®Œæˆ

4. **æ¿€æ´»ç¯å¢ƒ**ï¼š
   ```bash
   conda activate 1cellbio
   ```

5. **éªŒè¯ç¯å¢ƒ**ï¼š
   - å‘½ä»¤æç¤ºç¬¦åº”è¯¥å˜æˆï¼š`(1cellbio) username@MacBook-Pro ~ %`
   - è¿™è¡¨ç¤ºæ‚¨ç°åœ¨åœ¨icellbioç¯å¢ƒä¸­

## 5.3 åœ¨æ–°ç¯å¢ƒä¸­å®‰è£…anndata

1. **ç¡®ä¿åœ¨icellbioç¯å¢ƒä¸­**ï¼ˆå‘½ä»¤æç¤ºç¬¦å‰æœ‰`(1cellbio)`ï¼‰

2. **å®‰è£…anndataå’Œç›¸å…³åŒ…**ï¼š
   ```bash
   conda install -c conda-forge anndata pandas numpy scipy matplotlib
   ```

3. **ç¡®è®¤å®‰è£…**ï¼š
   - å½“æç¤ºæ—¶è¾“å…¥ `y`
   - ç­‰å¾…å®‰è£…å®Œæˆ

4. **éªŒè¯anndataå®‰è£…**ï¼š
   ```bash
   python -c "import anndata; print('anndata version:', anndata.__version__)"
   ```
   åº”è¯¥çœ‹åˆ°ï¼š`anndata version: 0.11.x`

âœ… **å¦‚æœçœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜condaç¯å¢ƒå’Œanndataéƒ½å®‰è£…æˆåŠŸï¼**

# ç¬¬å…­æ­¥ï¼šå®‰è£…RåŒ…å’Œä¾èµ–

## 6.1 åœ¨RStudioä¸­å®‰è£…åŸºç¡€RåŒ…

1. **æ‰“å¼€RStudio**

2. **å®‰è£…åŸºç¡€åŒ…**ï¼š
   åœ¨Consoleä¸­é€è¡Œè¿è¡Œä»¥ä¸‹ä»£ç ï¼š
   ```r
   # å®‰è£…åŸºç¡€åŒ…
   install.packages(c("devtools", "reticulate", "Matrix", "data.table", "hdf5r", "jsonlite"))
   ```

3. **å¤„ç†ç¼–è¯‘é—®é¢˜**ï¼ˆå¦‚æœé‡åˆ°ï¼‰ï¼š
   å¦‚æœé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œå¯ä»¥å°è¯•å®‰è£…äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼š
   ```r
   # å¼ºåˆ¶å®‰è£…äºŒè¿›åˆ¶ç‰ˆæœ¬
   install.packages(c("devtools", "reticulate", "Matrix", "data.table"), 
                    type = "binary")
   ```

4. **å®‰è£…Bioconductorç›¸å…³åŒ…**ï¼š
   ```r
   # å®‰è£…BiocManager
   if (!requireNamespace("BiocManager", quietly = TRUE))
       install.packages("BiocManager")
   
   # å®‰è£…ç”Ÿç‰©ä¿¡æ¯å­¦ç›¸å…³åŒ…
   BiocManager::install(c("SingleCellExperiment", "SummarizedExperiment", "S4Vectors"))
   ```

## 6.2 å¤„ç†ç‰¹æ®Šçš„macOSé—®é¢˜

### 6.2.1 è§£å†³hdf5rå®‰è£…é—®é¢˜

hdf5råŒ…åœ¨macOSä¸Šå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†ï¼š

1. **é¦–å…ˆå°è¯•brewå®‰è£…hdf5**ï¼ˆåœ¨ç»ˆç«¯ä¸­ï¼‰ï¼š
   ```bash
   # å¦‚æœæ²¡æœ‰brewï¼Œå…ˆå®‰è£…Homebrew
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
   
   # å®‰è£…hdf5
   brew install hdf5
   ```

2. **ç„¶ååœ¨RStudioä¸­å®‰è£…hdf5r**ï¼š
   ```r
   # è®¾ç½®ç¯å¢ƒå˜é‡
   Sys.setenv(HDF5_DIR = "/opt/homebrew/opt/hdf5")  # Apple Silicon
   # æˆ–è€…å¯¹äºIntel Mac:
   # Sys.setenv(HDF5_DIR = "/usr/local/opt/hdf5")
   
   # å®‰è£…hdf5r
   install.packages("hdf5r")
   ```

### 6.2.2 Apple Siliconç‰¹æ®Šå¤„ç†

å¦‚æœæ‚¨ä½¿ç”¨Apple Silicon Macï¼Œå¯èƒ½éœ€è¦ï¼š

```r
# è®¾ç½®ç¼–è¯‘å™¨è·¯å¾„
Sys.setenv(CC = "/opt/homebrew/bin/gcc-13")  # å¦‚æœå®‰è£…äº†gcc
Sys.setenv(CXX = "/opt/homebrew/bin/g++-13")

# æˆ–è€…ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç¼–è¯‘å™¨
Sys.setenv(CC = "clang")
Sys.setenv(CXX = "clang++")
```

## 6.3 å®‰è£…ICellbioRpyåŒ…

**æ³¨æ„**ï¼šè¿™é‡Œæˆ‘ä»¬å‡è®¾ICellbioRpyåŒ…å·²ç»å‘å¸ƒåˆ°GitHubã€‚

```r
# ä»GitHubå®‰è£…ICellbioRpyåŒ…
devtools::install_github("your_username/ICellbioRpy")

# å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥è®¾ç½®ä»£ç†æˆ–ä½¿ç”¨é•œåƒ
# options(download.file.method = "libcurl")
```

å¦‚æœä»æœ¬åœ°å®‰è£…ï¼š
```r
# ä»æœ¬åœ°å®‰è£…ï¼ˆå¦‚æœæ‚¨æœ‰æºç åŒ…ï¼‰
devtools::install_local("path/to/ICellbioRpy")
```

# ç¬¬ä¸ƒæ­¥ï¼šé…ç½®Python-Räº¤äº’ç¯å¢ƒ

## 7.1 åœ¨RStudioä¸­é…ç½®reticulate

1. **åŠ è½½reticulateåŒ…**ï¼š
   ```r
   library(reticulate)
   ```

2. **æŸ¥çœ‹å¯ç”¨çš„condaç¯å¢ƒ**ï¼š
   ```r
   conda_list()
   ```
   æ‚¨åº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„"1cellbio"ç¯å¢ƒ

3. **æŒ‡å®šä½¿ç”¨icellbioç¯å¢ƒ**ï¼š
   ```r
   use_condaenv("1cellbio", required = TRUE)
   ```

4. **éªŒè¯Pythoné…ç½®**ï¼š
   ```r
   py_config()
   ```
   æ£€æŸ¥è¾“å‡ºä¸­çš„Pythonè·¯å¾„æ˜¯å¦æŒ‡å‘icellbioç¯å¢ƒ

## 7.2 å¤„ç†macOSç‰¹æ®Šçš„è·¯å¾„é—®é¢˜

åœ¨macOSä¸Šï¼Œcondaç¯å¢ƒè·¯å¾„å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼š

```r
# å¦‚æœè‡ªåŠ¨æ£€æµ‹æœ‰é—®é¢˜ï¼Œæ‰‹åŠ¨æŒ‡å®šè·¯å¾„
# æ£€æŸ¥condaç¯å¢ƒä½ç½®
system("conda info --envs")

# Apple Siliconå…¸å‹è·¯å¾„
# /opt/anaconda3/envs/1cellbio/bin/python

# Intel Macå…¸å‹è·¯å¾„  
# /Users/YourName/anaconda3/envs/1cellbio/bin/python

# æ‰‹åŠ¨æŒ‡å®šï¼ˆæ ¹æ®å®é™…è·¯å¾„è°ƒæ•´ï¼‰
use_python("/opt/anaconda3/envs/1cellbio/bin/python")
```

## 7.3 æµ‹è¯•ICellbioRpyçš„Pythonç¯å¢ƒé…ç½®

1. **åŠ è½½ICellbioRpyåŒ…**ï¼š
   ```r
   library(ICellbioRpy)
   ```

2. **é…ç½®Pythonç¯å¢ƒ**ï¼š
   ```r
   configure_python_env(conda_env = "1cellbio", verbose = TRUE)
   ```

3. **æ£€æŸ¥anndataå¯ç”¨æ€§**ï¼š
   ```r
   check_anndata_available()
   ```

âœ… **å¦‚æœçœ‹åˆ° "âœ“ anndata is available (version: X.X.X)"ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼**

# ç¬¬å…«æ­¥ï¼šå®Œæ•´åŠŸèƒ½æµ‹è¯•

## 8.1 è¿è¡Œæµ‹è¯•è„šæœ¬

åœ¨RStudioä¸­è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š

```r
# æµ‹è¯•è„šæœ¬
cat("=== ICellbioRpy macOS å®Œæ•´åŠŸèƒ½æµ‹è¯• ===\n")

# 1. æ£€æŸ¥ç³»ç»Ÿä¿¡æ¯
cat("ç³»ç»Ÿä¿¡æ¯:", Sys.info()["sysname"], Sys.info()["machine"], "\n")

# 2. åŠ è½½åŒ…
library(ICellbioRpy)
cat("âœ“ ICellbioRpyåŒ…åŠ è½½æˆåŠŸ\n")

# 3. é…ç½®Pythonç¯å¢ƒ
configure_python_env(conda_env = "1cellbio", verbose = TRUE)
cat("âœ“ Pythonç¯å¢ƒé…ç½®æˆåŠŸ\n")

# 4. æ£€æŸ¥anndata
check_anndata_available()
cat("âœ“ anndataæ£€æŸ¥é€šè¿‡\n")

# 5. æ£€æŸ¥ä¸»è¦å‡½æ•°
functions_to_check <- c("read1Cellbio", "iCellbio2H5ad", "seurat_to_h5ad", "read_10x_mtx_to_h5ad")
for (func in functions_to_check) {
  if (exists(func)) {
    cat("âœ“", func, "å‡½æ•°å¯ç”¨\n")
  } else {
    cat("âœ—", func, "å‡½æ•°ä¸å¯ç”¨\n")
  }
}

# 6. æ£€æŸ¥ç¼–è¯‘å·¥å…·
cat("\nXcode Command Line Tools:", 
    ifelse(system("xcode-select -p", ignore.stdout = TRUE) == 0, "âœ“ å·²å®‰è£…", "âœ— æœªå®‰è£…"), "\n")

cat("\n=== æµ‹è¯•å®Œæˆ ===\n")
cat("å¦‚æœæ‰€æœ‰é¡¹ç›®éƒ½æ˜¾ç¤º âœ“ï¼Œè¯´æ˜ç¯å¢ƒé…ç½®å®Œå…¨æˆåŠŸï¼\n")
```

## 8.2 åˆ›å»ºç®€å•ç¤ºä¾‹

æµ‹è¯•ä¸€ä¸ªç®€å•çš„Python-Räº¤äº’ï¼š

```r
# ç®€å•çš„Python-Räº¤äº’æµ‹è¯•
library(reticulate)

# åœ¨Pythonä¸­åˆ›å»ºæ•°æ®
py_run_string("
import numpy as np
import pandas as pd
test_data = np.random.rand(5, 3)
df = pd.DataFrame(test_data, columns=['A', 'B', 'C'])
print('Python DataFrame created successfully!')
")

# åœ¨Rä¸­è®¿é—®Pythonæ•°æ®
py_df <- py$df
print(py_df)

cat("âœ“ Python-Ræ•°æ®äº¤äº’æµ‹è¯•æˆåŠŸï¼\n")
```

# ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

## é—®é¢˜1ï¼šCommand Line Toolså®‰è£…å¤±è´¥

**ç—‡çŠ¶**ï¼š`xcode-select --install`å‘½ä»¤æ²¡æœ‰å¼¹å‡ºå®‰è£…å¯¹è¯æ¡†

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ–¹æ³•1ï¼šç›´æ¥ä»App Storeå®‰è£…Xcode
# æ‰“å¼€App Storeï¼Œæœç´¢"Xcode"ï¼Œç‚¹å‡»å®‰è£…

# æ–¹æ³•2ï¼šé‡ç½®xcode-select
sudo xcode-select --reset
xcode-select --install

# æ–¹æ³•3ï¼šæ‰‹åŠ¨ä¸‹è½½
# è®¿é—® https://developer.apple.com/download/more/
# ä¸‹è½½é€‚åˆæ‚¨ç³»ç»Ÿç‰ˆæœ¬çš„Command Line Tools
```

## é—®é¢˜2ï¼šcondaå‘½ä»¤æ— æ•ˆ

**ç—‡çŠ¶**ï¼šåœ¨ç»ˆç«¯ä¸­è¾“å…¥`conda --version`æç¤ºå‘½ä»¤ä¸å­˜åœ¨

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥Anacondaæ˜¯å¦å®‰è£…åœ¨é»˜è®¤ä½ç½®
ls /opt/anaconda3/bin/conda

# 2. æ‰‹åŠ¨æ·»åŠ åˆ°PATH
echo 'export PATH="/opt/anaconda3/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc

# 3. é‡æ–°åˆå§‹åŒ–conda
/opt/anaconda3/bin/conda init zsh

# 4. é‡å¯ç»ˆç«¯
```

## é—®é¢˜3ï¼šApple Siliconå…¼å®¹æ€§é—®é¢˜

**ç—‡çŠ¶**ï¼šæŸäº›åŒ…åœ¨Apple Siliconä¸Šå®‰è£…å¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. ä½¿ç”¨Rosettaè¿è¡Œç»ˆç«¯
# å³é”®ç‚¹å‡»ç»ˆç«¯åº”ç”¨ â†’ æ˜¾ç¤ºç®€ä»‹ â†’ å‹¾é€‰"ä½¿ç”¨Rosettaæ‰“å¼€"

# 2. å®‰è£…x86ç‰ˆæœ¬çš„conda
arch -x86_64 conda install package_name

# 3. åœ¨Rä¸­è®¾ç½®ç‰¹å®šçš„repository
options(repos = c(CRAN = "https://cloud.r-project.org"))
```

## é—®é¢˜4ï¼šreticulateæ‰¾ä¸åˆ°Pythonç¯å¢ƒ

**ç—‡çŠ¶**ï¼š`conda_list()`è¿”å›ç©ºç»“æœæˆ–æŠ¥é”™

**è§£å†³æ–¹æ³•**ï¼š
```r
# 1. æ£€æŸ¥condaè·¯å¾„
Sys.which("conda")

# 2. æ‰‹åŠ¨è®¾ç½®condaè·¯å¾„
Sys.setenv(RETICULATE_CONDA = "/opt/anaconda3/bin/conda")

# 3. ç›´æ¥æŒ‡å®šPythonè·¯å¾„
use_python("/opt/anaconda3/envs/1cellbio/bin/python")

# 4. é‡å¯Rä¼šè¯
.rs.restartR()
```

## é—®é¢˜5ï¼šhdf5rå®‰è£…å¤±è´¥

**ç—‡çŠ¶**ï¼šhdf5råŒ…ç¼–è¯‘å¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
```bash
# åœ¨ç»ˆç«¯ä¸­å®‰è£…HDF5åº“
brew install hdf5

# å¦‚æœæ˜¯Apple Silicon
brew install --cask homebrew/cask-versions/adoptopenjdk8
```

ç„¶ååœ¨Rä¸­ï¼š
```r
# è®¾ç½®ç¯å¢ƒå˜é‡
Sys.setenv(HDF5_DIR = "/opt/homebrew/opt/hdf5")  # Apple Silicon
# æˆ–è€…
Sys.setenv(HDF5_DIR = "/usr/local/opt/hdf5")     # Intel

# é‡æ–°å®‰è£…
install.packages("hdf5r", type = "source")
```

## é—®é¢˜6ï¼šæƒé™é—®é¢˜

**ç—‡çŠ¶**ï¼šå®‰è£…æ—¶æç¤ºæƒé™ä¸è¶³

**è§£å†³æ–¹æ³•**ï¼š
```bash
# ä¿®å¤ç”¨æˆ·ç›®å½•æƒé™
sudo chown -R $(whoami):staff ~/anaconda3

# ä¿®å¤RåŒ…åº“æƒé™
sudo chown -R $(whoami):staff /Library/Frameworks/R.framework/Versions/*/Resources/library
```

# ğŸ’¡ Apple Silicon (M1/M2/M3) ç‰¹æ®Šæ³¨æ„äº‹é¡¹

## ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨åŸç”ŸARM64ç‰ˆæœ¬**ï¼š
   - Ré€‰æ‹©arm64ç‰ˆæœ¬
   - Anacondaé€‰æ‹©M1ç‰ˆæœ¬
   - é¿å…é€šè¿‡Rosettaè¿è¡Œï¼ˆé™¤éå¿…è¦ï¼‰

2. **ç¼–è¯‘å™¨è®¾ç½®**ï¼š
   ```r
   # åœ¨Rä¸­è®¾ç½®ç¼–è¯‘å™¨
   Sys.setenv(CC = "clang")
   Sys.setenv(CXX = "clang++")
   ```

3. **åŒ…å®‰è£…ç­–ç•¥**ï¼š
   ```r
   # ä¼˜å…ˆä½¿ç”¨äºŒè¿›åˆ¶åŒ…
   options(pkgType = "binary")
   
   # å¦‚æœå¿…é¡»ç¼–è¯‘ï¼Œè®¾ç½®ç¼–è¯‘å‚æ•°
   options(configure.args = "--disable-openmp")
   ```

# ğŸ‰ æ­å–œï¼

å¦‚æœæ‚¨å®Œæˆäº†æ‰€æœ‰æ­¥éª¤ï¼Œæ­å–œæ‚¨å·²ç»æˆåŠŸæ­å»ºäº†å®Œæ•´çš„ICellbioRpyä½¿ç”¨ç¯å¢ƒï¼

## ä¸‹ä¸€æ­¥

ç°åœ¨æ‚¨å¯ä»¥ï¼š
1. å­¦ä¹ [æ•™ç¨‹1ï¼š1CellBioè½¬H5AD](tutorial_1_1cellbio_to_h5ad.Rmd)
2. å­¦ä¹ [æ•™ç¨‹2ï¼š1CellBioè½¬Seurat](tutorial_2_1cellbio_to_seurat.Rmd)
3. æ ¹æ®æ‚¨çš„æ•°æ®ç±»å‹é€‰æ‹©åˆé€‚çš„æ•™ç¨‹

## ä¿å­˜æ‚¨çš„ç¯å¢ƒé…ç½®

å»ºè®®åœ¨RStudioä¸­åˆ›å»ºä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼š

```r
# ä¿å­˜ä¸º setup_environment.R
library(ICellbioRpy)
configure_python_env(conda_env = "1cellbio", verbose = FALSE)

cat("âœ“ ICellbioRpyç¯å¢ƒå·²å°±ç»ªï¼\n")
cat("ç³»ç»Ÿ:", Sys.info()["sysname"], Sys.info()["machine"], "\n")
cat("Pythonç¯å¢ƒï¼šicellbio\n")
cat("å¯ç”¨å‡½æ•°ï¼š", paste(ls("package:ICellbioRpy"), collapse = ", "), "\n")
```

æ¯æ¬¡ä½¿ç”¨ICellbioRpyæ—¶ï¼Œåªéœ€è¿è¡Œï¼š`source("setup_environment.R")`

## macOSç‰¹æ®Šçš„æ€§èƒ½ä¼˜åŒ–

```r
# åˆ›å»º ~/.Rprofile æ–‡ä»¶è¿›è¡Œå…¨å±€é…ç½®
options(Ncpus = parallel::detectCores())  # ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
options(repos = c(CRAN = "https://cloud.r-project.org"))  # è®¾ç½®å¿«é€Ÿé•œåƒ

# ä¸ºApple Siliconä¼˜åŒ–
if (Sys.info()["machine"] == "arm64") {
  options(pkgType = "binary")  # ä¼˜å…ˆä½¿ç”¨äºŒè¿›åˆ¶åŒ…
}
```

---

**éœ€è¦å¸®åŠ©ï¼Ÿ**
- æŸ¥çœ‹å…¶ä»–æ•™ç¨‹è·å–ä½¿ç”¨æŒ‡å¯¼
- è®¿é—®GitHubé¡¹ç›®é¡µé¢å¯»æ±‚æ”¯æŒ
- åŠ å…¥ç”¨æˆ·äº¤æµç¾¤è·å–å¸®åŠ©

**ç¥æ‚¨åœ¨macOSä¸Šçš„å•ç»†èƒæ•°æ®åˆ†æé¡ºåˆ©ï¼** ğŸ§¬ğŸâœ¨